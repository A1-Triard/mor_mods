- TES3:
  - HEDR:
      version: 1067869798
      type: ESP
      author: A1
      description:
      - Восстановление магии, выдранное из сборника модов MFR.
      records: 8
  - MAST: Morrowind.esm
  - DATA: 79765994
  - MAST: Bloodmoon.esm
  - DATA: 11801192
  - MAST: Tribunal.esm
  - DATA: 6618333

- GLOB:
  - NAME: KPCMagickaMultiplier
  - FNAM: f
  - FLTV: 0.0

- GLOB:
  - NAME: KPCMagickaReturnBase
  - FNAM: f
  - FLTV: 0.75

- GLOB:
  - NAME: KPCMagickaReturnMult
  - FNAM: f
  - FLTV: 0.02

- GLOB:
  - NAME: KPCMagickaRegenEnabled
  - FNAM: s
  - FLTV: 1.0

- SCPT:
  - SCHD:
      name: al_1MagickaRegCheck
      vars:
        shorts: 1
        longs: 0
        floats: 2
      data_size: 817
      var_table_size: 46
  - SCVR:
    - DoOnce
    - PCRaceMultiplier
    - PCBirthsignMultiplier
  - SCDT: "eJx9kl1LwmAUx3csV1bUolfohVN0V4xN8NKbJIJCiK68k2f2aMPpxBfCb9dH6CMMdSXmli9EF5X0TBdOm7GbA//z/5/fOXt4gCAmUOBOIAQ8LIWw\
           BBxGoygF4XLz+iYWJxk1lSXxilZWC5pKi4Fp6ZaWK8X8OSnRBZREKRzx1Z2AoS7Jjr7t1TM0f5EnikbvAiivAF/QSJUWeYAtTBytn6G++KDnFIWl\
           OGQyJ1xxT/Zzw7SsTxPf7Aa+WEbLbuNjr2NbxruBloltu97vYc3udnuGZdRemzWj94Vto978MLut/gC/LbNTbw5EjlsA4IQ5ThRZHYIgsAswDqdK\
           O5XkJTp2ibZyI3jMsb1Q0fOVUlKWhniubbzIIsCRa9v0sUXGrnl2oIjX9++4CaMsRobEgWniXTdiOU2qSBRVU8vVX2Pg78R9t32NamlFZxf3sciT\
           Fv+/5PaGRcnh8n9Lqygjo8dTZL146sEO+oZKPMwd4qzHMxzLNj7BxIFwhrkdoiVlbx8tkrKqj5L2hFlyCJxvX9iY1GP3NJUF+AGl4fFR"
  - SCTX:
    - Begin al_1MagickaRegCheck
    - ''
    - ;global script that gets run once to check the PC's magicka regeneration
    - ''
    - short DoOnce
    - float PCRaceMultiplier
    - float PCBirthsignMultiplier
    - ''
    - if ( menumode )
    - "\treturn"
    - ;elseif ( al_mpregen_check == 0 )
    - ";\treturn"
    - endif
    - ''
    - ;просто тест видео через новую игру
    - ;playbink "MFR_clanger1" 1
    - ''
    - if ( DoOnce == 0 )
    - "\t; Restart default values"
    - "\tset KPCMagickaMultiplier to 0"
    - "\tset KPCMagickaReturnBase to 0.0250"
    - "\tset KPCMagickaReturnMult to 0.0010"
    - "\tset KPCMagickaRegenEnabled to 1"
    - "\tif ( Player -> GetSpellEffects, \"wombburn\" == 1 )"
    - "\t\tMessageBox \"Рожденные под знаком Атронаха не могут восстанавливать магическую энергию.\""
    - ";\telseif ( Player -> GetSpellEffects, \"wombburn (Secunda)\" == 1 )"
    - ";\t\tMessageBox \"Рожденные под знаком Атронаха не могут восстанавливать магическую энергию.\""
    - "\telse"
    - "\t\tMessageBox \"...\""
    - "\tendif"
    - "\tset DoOnce to 1"
    - endif
    - ''
    - ;RaceCheck
    - set PCRaceMultiplier to 0
    - if ( Player -> GetSpellEffects, "magicka mult bonus_10" == 1 ) ;
    - "\tset PCRaceMultiplier to 1"
    - elseif ( Player -> GetSpellEffects, "magicka mult bonus_5" == 1 ) ;
    - "\tset PCRaceMultiplier to 0.5"
    - elseif ( Player -> GetSpellEffects, "magicka mult bonus_15" == 1 ) ;
    - "\tset PCRaceMultiplier to 1.5"
    - endif
    - ;Birthsign Check
    - set PCBirthsignMultiplier to 0
    - if ( Player -> GetSpellEffects, "fay ability"  == 1 ) ; The Mage birthsign
    - "\tset PCBirthsignMultiplier to 0.5\t"
    - "elseif ( Player->GetSpellEffects, \"elfborn ability\"\t== 1 )   ; The Apprentice birthsign"
    - "\tset PCBirthsignMultiplier to 1.5"
    - 'elseif ( Player -> GetSpellEffects, "wombburn" == 1 ) '
    - "\tset PCBirthsignMultiplier to 2.0 ; The Atronach birthsign"
    - endif
    - ''
    - set KPCMagickaMultiplier to ( 1 + PCRaceMultiplier + PCBirthsignMultiplier )
    - ''
    - ;if ( al_mpregen_check >= 1 )
    - "\tif ( Player -> GetSpellEffects, \"wombburn\" == 0 )"
    - ";\t\tif ( Player -> GetSpellEffects, \"wombburn (Secunda)\" == 0 )"
    - "\t\t\tif ( KPCMagickaRegenEnabled == 1 )"
    - "\t\t\t\tif ( ScriptRunning, al_1MagickaRegeneration == 0 )"
    - "\t\t\t\t\tStartScript \"al_1MagickaRegeneration\""
    - "\t\t\t\tendif"
    - "\t\t\tendif"
    - ";\t\tendif "
    - "\tendif"
    - ;endif
    - ''
    - StopScript al_1MagickaRegCheck
    - ''
    - End

- SCPT:
  - SCHD:
      name: al_1MagickaRegeneration
      vars:
        shorts: 6
        longs: 1
        floats: 4
      data_size: 610
      var_table_size: 137
  - SCVR:
    - Update
    - CheckInitTime
    - CheckTimePassing
    - InitGameHour
    - InitDaysPassed
    - CurGameHour
    - Health
    - TimePassed
    - TotalMagicka
    - MagickaRegenRate
    - WaitedTime
  - SCDT: "eJx9UU1Lw0AQnUmabbcWScWLB2EORbBF3VgRD7YHFaJIoaiHXJe6kWCqJWkP/Qce/C36F52NtR9+HXaGmfd4M29WYFlSRD51OhQILEnKHbCF8jAv\
           QY3CSqiH5vJ5kgF3PFinsHqhp3lf57m5tz0HHAo4uzZLbKDEGopRqqcmE4hVik7qL4U+k5BJag5XEHn6W/0/9P1P1Fmj6NWnU0oR4AfuIbc9y4Ay\
           4gzm/QRW2KQLX6riu8m4BI0Vk8S2aY8Oj6hJTCe+C5ctgY4kJlO3EIoRtoqyfawUM0N5lwzN7UCnhg4W42eHUrPDKbsQ22S4uHoDyygLsSpxoGjD\
           t5OELKpu8UnunB4suY0d2KZox6dw87p/3tMPyeBR9ybpOBmlicmoucx14YrUvgpWyDdmPMmeznRufmlbJYp2fXbW4sfTbOQ1FrrtOuuCtRjjpzWJ\
           iB/KmHD/"
  - SCTX:
    - Begin al_1MagickaRegeneration
    - ''
    - Short Update
    - float TimePassed
    - float TotalMagicka
    - float MagickaRegenRate
    - short CheckInitTime
    - short CheckTimePassing
    - short InitGameHour
    - short InitDaysPassed
    - short CurGameHour
    - float WaitedTime
    - Long Health
    - ''
    - if ( MenuMode == 1)
    - "\tif ( CheckInitTime == 0 )"
    - "\t\tset InitGameHour to GameHour"
    - "\t\tset InitDaysPassed to DaysPassed"
    - "\t\tset CheckInitTime to 1"
    - "\t\tset CheckTimePassing to 1"
    - "\tendif"
    - "\treturn"
    - endif
    - ''
    - if ( player->geteffect, sEffectStuntedMagicka == 1 )
    - "\tset Update to 0"
    - elseif ( player->GetWeaponDrawn == 1 )
    - "\tset Update to 0"
    - elseif ( player->GetSpellReadied == 1 )
    - "\tset Update to 0"
    - elseif ( player->GetHealth < Health )
    - "\tset Update to 0"
    - "\tSet Health to ( Player->GetHealth )"
    - else
    - "\tset Update to 1"
    - Endif
    - ''
    - "\tif ( CheckTimePassing == 1 )"
    - "\t\tset CurGameHour to GameHour"
    - "\t\tset WaitedTime to ( ( DaysPassed - InitDaysPassed ) * 24 ) + ( CurGameHour - InitGameHour )"
    - "\t\tif ( WaitedTime >= 1 )"
    - "\t\t\tset TimePassed to ( ( WaitedTime * 3600 ) / TimeScale )"
    - "\t\t\tset Update to 1\t\t"
    - "\t\tendif"
    - "\t\tset CheckTimePassing to 0"
    - "\t\tset CheckInitTime to 0"
    - "\tendif"
    - ''
    - if ( Update == 0 )
    - "\treturn"
    - else
    - "\tset TimePassed to ( TimePassed + GetSecondsPassed )"
    - "\tif ( TimePassed >= 1 )"
    - "\t\tif ( Update == 1 )"
    - "\t\t\tset TotalMagicka to ( ( Player -> GetIntelligence ) * KPCMagickaMultiplier )"
    - "\t  \t\tset MagickaRegenRate to 0.01 * ( KPCMagickaReturnBase + ( KPCMagickaReturnMult * ( Player -> GetWillpower ) ) ) * TotalMagicka * TimePassed"
    - "\t\t\tPlayer -> ModCurrentMagicka, MagickaRegenRate"
    - "\t\tendif"
    - "\t\tset TimePassed to 0"
    - "\tendif"
    - endif
    - ''
    - End

- SCPT:
  - SCHD:
      name: al_MPREGEN
      vars:
        shorts: 2
        longs: 0
        floats: 1
      data_size: 715
      var_table_size: 22
  - SCVR:
    - Button
    - difftize
    - timer
  - SCDT: "eJx1ks9rE0EUx2cW0maDh0EpHozyFXqya8h68GTxUEpOFamX3GQJa1vaRmjjn+E/VXr16H0y6dAxuztmJmiEBNfZTROMxNv7Me+9z/u+2aBbPi49\
           gt1dhBV6SUkF7SeMbFBag/OK+PNwm1Zp1V/4TY/VzuPuJ3TOTjqnhAXkWmU8VRNphjzHSA5kJkf8p8qR8oFS4EOrhBppwTPeIMSN8YiHF+W4Tdce\
           IZ65gUD7MQtw/iA6ex8eREeueXQYH+0dx53Tcu4jti7l0zqrufjB28P91v6bKt1ckob/kDbJ1RTaDvktT5SZORM3S3T97S90NUf/H219LUmdPVyN\
           xt34IuqdfOyuEPrUp25dH22wknJ7HthC697ecXTRirvvelEvxtO59kXSq+KD2+kVXlaoM2ql177PsHOXX16xSdhn8lVbmSj0pxDTABOrC4v/4uVW\
           OYQ2xrpjiEQJnnCnhNEQI5m67VMI3HKhjEq1sarQyFVKJw43UygYlbheOlGvcYW+/r2upZ2ZHJlEf3wjbYN4O9c8wPexsTOkOr+rsHy4WiWtyRsk\
           +CJtgLL8h56Mi2d6oBcvtUhktvhYjcVxQp9S+gcF6Eg1"
  - SCTX:
    - begin al_MPREGEN
    - ''
    - short Button
    - short difftize
    - float timer
    - ''
    - if ( difftize == 1 )
    - "\tSet button to GetButtonPressed"
    - "\tif ( button == -1 )"
    - "\t\treturn"
    - "\telseif (button == 0 )"
    - "\t\tPlaySound, \"menu click\""
    - "\t\tMessageBox \"Динамическая регенерация магии активирована.\""
    - ";\t\tset al_mpregen_check to 1"
    - "\t\tset difftize to 2"
    - "\t\tset button to -1"
    - "\t\tif ( ScriptRunning, al_1MagickaRegCheck == 0 )"
    - "\t\t\tstartscript \"al_1MagickaRegCheck\""
    - "\t\tendif"
    - "\t\t;startscript \"al_TRAVGlobalScr\""
    - "\t\tStopScript \"al_MPREGEN\""
    - "\telseif (button == 1 )"
    - "\t\tPlaySound, \"menu click\""
    - "\t\tMessageBox \"Вы отказались от динамической регенерации магии.\""
    - ";\t\tset al_mpregen_check to -1"
    - "\t\tset difftize to 2"
    - "\t\tset button to -1"
    - "\t\t;startscript \"al_TRAVGlobalScr\""
    - "\t\tstopscript \"al_1MagickaRegCheck\""
    - "\t\tstopscript \"al_1MagickaRegeneration\""
    - "\t\tStopScript \"al_MPREGEN\""
    - "\tendif"
    - endif
    - ''
    - If ( MenuMode == 1 )
    - "\tReturn"
    - Endif
    - ''
    - if ( CharGenState != -1 )
    - "\treturn"
    - endif
    - ''
    - if ( timer < 6 )
    - "\tset timer to ( timer + GetSecondsPassed )"
    - "\treturn"
    - endif
    - ''
    - if ( difftize == 0 )
    - "\tmessagebox \"Хотели бы вы, чтобы ваша магия восстанавливалась со временем в зависимости от вашей расы и силы воли? В бою магия восстанавливаться не будет.\", \"Да, пусть моя магия так восстанавливается.\", \"Нет, я не хочу такого восстановления магии.\""
    - "\tset difftize to 1"
    - Endif
    - ''
    - End

- SSCR:
  - DATA: '2931311741873110496'
  - NAME: al_MPREGEN
